# Медицинское приложение на Tornado и Redis

## Описание проекта

Данное приложение представляет собой REST API для управления медицинскими данными: больницами, врачами, пациентами, диагнозами и связями между врачами и пациентами.

Используется Tornado как асинхронный веб-сервер и Redis в качестве базы данных ключ-значение.

---

## Архитектура

- **Сервер:** Tornado (Python)
- **База данных:** Redis (ключ-значение)
- **Основные сущности:** Hospital, Doctor, Patient, Diagnosis, DoctorPatient (связь врач-пациент)
- **Типы запросов:**
  - GET для получения списка сущностей
  - POST для создания новых записей

Данные хранятся в Redis с использованием автоинкрементных ID для каждой сущности.

---

## Запуск проекта

### Требования

- Python 3.9+
- Redis сервер
- Необходимые Python-библиотеки:
  - tornado
  - redis
  - requests (для тестов)

### Инструкция

1. Запустите Redis сервер (по умолчанию на localhost:6379).
2. Клонируйте репозиторий или скачайте проект.
3. Установите зависимости:
   ```bash
   pip install -r requirements.txt
   ```
4. Запустите сервер:

    ```python3 main.py```
    
5. Сервер запущен на http://localhost:8888.
## API

### Hospital

- `GET /hospital` — получить список больниц
- `POST /hospital` — добавить больницу  
  Параметры: `name`, `address`, `phone`, `beds_number`

### Doctor

- `GET /doctor` — получить список врачей
- `POST /doctor` — добавить врача  
  Параметры: `surname`, `profession`, `hospital_ID`

### Patient

- `GET /patient` — получить список пациентов
- `POST /patient` — добавить пациента  
  Параметры: `surname`, `born_date`, `sex` ('M' или 'F'), `mpn`

### Diagnosis

- `GET /diagnosis` — получить список диагнозов
- `POST /diagnosis` — добавить диагноз  
  Параметры: `patient_ID`, `type`, `information`

### DoctorPatient (Связь врач-пациент)

- `GET /doctor-patient` — получить связи
- `POST /doctor-patient` — создать связь  
  Параметры: `doctor_ID`, `patient_ID`

---

## Тестирование

### Юнит-тесты

- Все юнит-тесты расположены в папке `tests/`.
- Запуск:
  ```bash
  python3 -m unittest discover tests
    ```
Тесты проверяют корректность API и взаимодействие с Redis.

## Нагрузочное тестирование

Для оценки производительности API использовался инструмент ApacheBench (ab).  
Тесты выполнялись по POST-запросам с параметрами из файлов `post_data/*.txt`.

### Параметры тестов

- Количество запросов (`-n`): от 10 до 50  
- Уровень конкурентности (`-c`): от 2 до 5  
- Тип содержимого: `application/x-www-form-urlencoded`  
- Целевой URL: локальный сервер `http://127.0.0.1:8888/<endpoint>`  

### Пример вызова

```bash
ab -n 50 -c 5 -p doctor_post.txt -T application/x-www-form-urlencoded http://127.0.0.1:8888/doctor
```

### Результаты тестирования

- **/patient**  
  - 10 запросов, конкурентность 2  
  - Все запросы выполнены успешно  
  - Время ответа в среднем ~5 мс  
  - RPS (Requests per second): около 380

- **/doctor**  
  - 50 запросов, конкурентность 5  
  - Почти все запросы успешны после корректировки данных  
  - Время ответа в среднем ~7 мс  
  - RPS: около 630

- **/diagnosis**  
  - 10 запросов, конкурентность 2  
  - Все запросы успешны после исправления параметров  
  - Время ответа в среднем ~6 мс  
  - RPS: около 340

### Выводы

API стабильно обрабатывает запросы с высокой скоростью и низкой задержкой при умеренной нагрузке.  
Ошибки возникали при некорректных данных или отсутствующих зависимостях (например, ссылки на несуществующие больницы или пациенты).  
Рекомендуется доработать валидацию данных на стороне клиента и сервера для повышения надёжности.


## Структура проекта

```hits-docker-practice-HW/
├── python3-app/
│   ├── main.py                   # Основной серверный код на Tornado
│   ├── post_data/                # Файлы с данными для нагрузочного тестирования
│   ├── static/                   # Статические файлы (CSS, JS и др.)
│   ├── templates/                # HTML-шаблоны для рендеринга страниц
│   ├── tests/                    # Юнит-тесты
│   │   ├── test_endpoints.py
│   │   └── test_main.py          # Тесты для основного приложения (Tornado AsyncHTTPTestCase)
│   ├── requirements.txt          # Зависимости Python
│   └── README.md                 # Документация проекта (если лежит здесь)
├── .github/                      # Конфигурация GitHub Actions CI/CD (в корне репозитория)
│   └── workflows/
│       └── ci.yml                # Конфигурация пайплайна автоматизации
└── README.md                     # Общий README в корне (если есть)
```

## CI/CD

Для автоматизации сборки, тестирования и развёртывания проекта реализован CI/CD-пайплайн с использованием GitHub Actions.

При каждом пуше в ветку `master` и создании pull request запускаются автоматические тесты.

Конфигурация пайплайна хранится в `.github/workflows/ci.yml`.

Пайплайн включает следующие шаги:

- Проверка исходного кода (checkout)
- Установка Python 3.9
- Установка зависимостей из `requirements.txt`
- Запуск юнит-тестов
- Запуск Redis как сервис для интеграционных тестов

Пайплайн помогает поддерживать качество кода и быстро выявлять ошибки.



